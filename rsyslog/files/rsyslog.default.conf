{%- from "rsyslog/map.jinja" import client,server,common with context -%}

{% if common.preserve_fqdn is defined and common.preserve_fqdn == true %}
$PreserveFQDN
{% endif %}

{% if common.non_kernel_facility is defined and common.non_kernel_facility == true %}
$KLogPermitNonKernelFacility on
{% endif %}

{% if common.omit_local_logging is defined and common.omit_local_logging == true %}
$OmitLocalLogging on
{% endif %}

{% if common.msg_reduction == true %}
$RepeatedMsgReduction on
{% endif %}

{% if common.max_message_size is defined %}
$MaxMessageSize {{ common.max_message_size }}
{% endif %}

{% if common.system_log_rate_limit_interval is defined %}
$SystemLogRateLimitInterval {{ common.system_log_rate_limit_interval }}
{% endif %}

{% if common.system_log_rateLimit_burst is defined %}
$SystemLogRateLimitBurst {{ common.system_log_rateLimit_burst }}
{% endif %}

{% for modname in common.modules %}
$ModLoad {{ modname }}
{% endfor %}

$DirCreateMode {{ common.perm_dir }}
$PrivDropToUser {{ common.run_user }}
$PrivDropToGroup {{ common.run_group }}
$WorkDirectory {{ common.spool_dir }}

$IncludeConfig {{ common.rsyslog_d }}/*.conf

{%- for name,config in common.output.file.iteritems() %}
{% if config.owner is defined %}
$FileOwner: {{ config['owner'] }}
{% endif %}
{% if config.group is defined %}
$FileGroup: {{ config['group'] }}
{% endif %}
{% if config.createmode is defined %}
$FileCreateMode: "{{ config['createmode'] }}"
{% endif %}
{% if config.umask is defined %}
$Umask: "{{ config['umask'] }}"
{% endif %}
{{ config['filter'] }}     {% if config.sync == true %}-{% endif %}{{ name }}
{% endfor %}

{% if common.output.console is defined %}
{% for name,config in common.output.console.iteritems() %}
{{ config['filter'] }}      {{ config['action'] }}
{% endfor %}
{% endif %}

{% if common.output.remote is defined %}
{% for name,config in common.output.console.iteritems() %}
{{ config['filter'] }}      {{ config['action'] }}
{% endfor %}
{% endif %}
